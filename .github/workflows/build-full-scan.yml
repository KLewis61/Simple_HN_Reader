name: "Build and full scan"

on:
  pull_request:
    branches: [main]
  release:
    types: [published]
  workflow_dispatch:
    branches: [main]
    
jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Install Java
          uses: actions/setup-java@v2
          with:
            java-version: '17'
            distribution: 'adopt'
            cache: 'gradle'

        - name: Validate Gradle wrapper
          uses: gradle/wrapper-validation-action@v1

        - name: Build with Gradle
          run: ./gradlew assembleDebug --no-daemon --stacktrace

        - name: Upload application artifact
          uses: actions/upload-artifact@v2
          with:
            name: app
            path: app/build/outputs/apk/debug/app-debug.apk
            retention-days: 3
